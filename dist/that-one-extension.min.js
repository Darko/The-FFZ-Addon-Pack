/*! That One Extension 21-11-2016 */
var addons=[],ffz,api,version="1.0.0",registerAddon=function(a){isInvalidHost()||(addons.includes(a)?console.log("Not registering duplicate addon!"):(addons.push(a),console.log("[TOE] Registered addon: "+a.name)))},doSettings=function(){addons.forEach(function(a){a.doSettings()})},init=function(){addons.forEach(function(a){a.init()})},room_add=function(a,b,c){addons.forEach(function(d){d.room_add(a,b,c)})},room_message=function(a){addons.forEach(function(b){b.room_message(a)})},chat_view_init=function(a,b){addons.forEach(function(c){c.chat_view_init(a,b)})},chat_view_destroy=function(a,b){addons.forEach(function(c){c.chat_view_destroy(a,b)})},invalidHosts=["api.","tmi.","spade.","chatdepot.","im."],isInvalidHost=function(){for(var a=0;a<invalidHosts.length;a++)if(window.location.host.indexOf(invalidHosts[a])!=-1)return!0;return!1},checkExistance=function(a){if(!isInvalidHost())if(void 0!==window.FrankerFaceZ&&void 0!==window.jQuery&&void 0!==window.App)ffz=FrankerFaceZ.get(),api=ffz.api("ThatOneExtension","https://cdn.lordmau5.com/Mau5Badge_Alpha.png",version),ffz.has_bttv&&api.log("BTTV was found. To ensure best possible compatibility, consider removing BTTV."),api.add_badge("that-one-extension",{name:"that-one-extension",title:"TOE Developer",image:"https://cdn.lordmau5.com/Mau5Badge.png",alpha_image:"https://cdn.lordmau5.com/Mau5Badge_Alpha.png",color:"#49acff"}),api.user_add_badge("lordmau5",20,"that-one-extension"),api.user_add_badge("quanto",20,"that-one-extension"),api.user_add_badge("faiizow",20,"that-one-extension"),api.log("Injected successfully."),doSettings(),init(),api.on("room-add",room_add),api.on("room-message",room_message),api.on("chat-view-init",chat_view_init),api.on("chat-view-destroy",chat_view_destroy),api.iterate_rooms(),api.iterate_chat_views();else{if(a=(a||0)+1,a<60)return setTimeout(checkExistance.bind(this,a),1e3);console.log("[ThatOneExtension] Could not find FFZ. Injection unsuccessful. (Host: "+window.location.host+")")}};setTimeout(checkExistance,3e3);var BTTV={name:"BetterTTV",log:function(a){api.log("["+BTTV.name+"] "+a)},vars:{global_emotes:!0,gif_emotes:!1,override_emotes:!1,pro_emotes:!0,show_emotes_in_menu:!0,channels:{},last_emote_set_id:0,socket:!1,global_emotes_loaded:!1,gif_emotes_loaded:!1},doSettings:function(){FrankerFaceZ.settings_info.bttv_global_emotes={type:"boolean",value:BTTV.vars.global_emotes,category:"TOE",name:"[BTTV] Global Emoticons",help:"Enable this to show global emotes.",on_update:function(a){return BTTV.vars.global_emotes_loaded?(a?(api.register_global_set("BTTV-Global-1"),BTTV.vars.gif_emotes&&api.register_global_set("BTTV-Global-2"),BTTV.vars.override_emotes&&api.register_global_set("BTTV-Global-3")):(api.unregister_global_set("BTTV-Global-1"),api.unregister_global_set("BTTV-Global-2"),api.unregister_global_set("BTTV-Global-3")),void(BTTV.vars.global_emotes=a)):void(a&&BTTV.addGlobals())}},FrankerFaceZ.settings_info.bttv_gif_emotes={type:"boolean",value:BTTV.vars.gif_emotes,category:"TOE",name:"[BTTV] GIF Emoticons",help:"Enable this to show GIF emotes.",on_update:function(a){var b,c;if(a)for(BTTV.vars.global_emotes&&api.register_global_set("BTTV-Global-2"),b=BTTV.vars.channels.length;b--;)c=BTTV.vars.channels[b],api.register_room_set(c,BTTV.vars.channels[c].gifemotes_setid,BTTV.vars.channels[c].gifemotes);else for(api.unregister_global_set("BTTV-Global-2"),b=BTTV.vars.channels.length;b--;)c=BTTV.vars.channels[b],BTTV.vars.channels[c].gifemotes_still?api.register_room_set(c,BTTV.vars.channels[c].gifemotes_setid,BTTV.vars.channels[c].gifemotes_still):api.unload_set(BTTV.vars.channels[c].gifemotes_setid);BTTV.vars.gif_emotes=a}},FrankerFaceZ.settings_info.bttv_override_emotes={type:"boolean",value:BTTV.vars.override_emotes,category:"TOE",name:"[BTTV] Enable Override Emotes",help:"Enable this to show override emotes (like D:).",on_update:function(a){a?BTTV.vars.global_emotes&&api.register_global_set("BTTV-Global-3"):api.unregister_global_set("BTTV-Global-3"),BTTV.vars.override_emotes=a}},FrankerFaceZ.settings_info.bttv_pro_emotes={type:"boolean",value:BTTV.vars.pro_emotes,category:"TOE",name:"[BTTV] Enable Pro Emotes",help:"Enable this to show Pro emotes from other users. (Requires refresh!)",on_update:function(a){if(!a)for(var b=BTTV.ProUsers.length;b--;){var c=BTTV.ProUsers[b];api.unload_set(c._id_emotes)}BTTV.vars.pro_emotes=a}},FrankerFaceZ.settings_info.bttv_show_emotes_in_menu={type:"boolean",value:BTTV.vars.show_emotes_in_menu,category:"TOE",name:"[BTTV] Show emotes in Emoticon Menu",help:"Enable this to show the emotes in the Emoticon Menu (you can still enter the emotes manually when this is disabled)",on_update:function(a){api.emote_sets["BTTV-Global-1"].hidden=!a,api.emote_sets["BTTV-Global-2"].hidden=!a,api.emote_sets["BTTV-Global-3"].hidden=!a;for(var b in BTTV.vars.channels)api.emote_sets[BTTV.vars.channels[b].emotes].hidden=!a,api.emote_sets[BTTV.vars.channels[b].gifemotes_setid].hidden=!a}},BTTV.vars.global_emotes=ffz.settings.get("bttv_global_emotes"),BTTV.vars.gif_emotes=ffz.settings.get("bttv_gif_emotes"),BTTV.vars.override_emotes=ffz.settings.get("bttv_override_emotes"),BTTV.vars.pro_emotes=ffz.settings.get("bttv_pro_emotes"),BTTV.vars.show_emotes_in_menu=ffz.settings.get("bttv_show_emotes_in_menu")},init:function(){return BTTV.log("Addon initialized!"),ffz.has_bttv?void BTTV.log("BTTV was found! Addon disabled!"):(BTTV.vars.socket=new BTTV.Socket,BTTV.addBadges(),BTTV.vars.global_emotes&&BTTV.addGlobals(),void(BTTV.vars.pro_emotes&&BTTV.vars.socket.connect()))},room_add:function(a,b,c){ffz.has_bttv||BTTV.addChannel(a,b,c)},room_message:function(a){ffz.has_bttv||BTTV.vars.pro_emotes&&ffz.get_user()&&a.from===ffz.get_user().login&&BTTV.vars.socket.broadcastMe(a.room)},chat_view_init:function(a,b){},chat_view_destroy:function(a,b){},addBadges:function(a){$.getJSON("https://api.betterttv.net/2/badges").done(function(a){for(var b=[],c=a.types,d=a.badges,e=c.length;e--;){var f=c[e],g={name:f.name,title:f.description,image:f.svg,no_invert:!0};b[g.name]=g,api.add_badge(g.name,g)}for(e=d.length;e--;){var h=d[e];void 0!==b[h.type]&&(BTTV.log("Adding badge '"+h.type+"' for user '"+h.name+"'."),api.user_add_badge(h.name,21,h.type))}}).fail(function(b){if(404!==b.status)return a=(a||0)+1,a<12?(BTTV.log("Failed to fetch badges. Trying again in 5 seconds."),setTimeout(BTTV.addBadges.bind(this,a),5e3)):void 0})},override_emotes:[":'(","D:"],isOverrideEmote:function(a){for(var b=0;b<BTTV.override_emotes.length;b++)if(a===BTTV.override_emotes[b])return!0;return!1},addGlobals:function(a){$.getJSON("https://api.betterttv.net/emotes").done(function(a){for(var b=[],c=[],d=[],e=a.emotes,f=e.length;f--;){var g=/[^A-Za-z0-9]/.test(e[f].regex),h=e[f],i=/cdn.betterttv.net\/emote\/(\w+)/.exec(h.url),j=i&&i[1];if(!h.channel){var k={urls:{1:h.url},name:h.regex,width:h.width,height:h.height,require_spaces:g};j&&(k.id=j,k.urls={1:"https://cdn.betterttv.net/emote/"+j+"/1x",2:"https://cdn.betterttv.net/emote/"+j+"/2x",4:"https://cdn.betterttv.net/emote/"+j+"/3x"}),BTTV.isOverrideEmote(h.regex)?d.push(k):"gif"===h.imageType?c.push(k):b.push(k)}}var l={emoticons:b};api.register_global_set("BTTV-Global-1",l),BTTV.vars.global_emotes||api.unregister_global_set("BTTV-Global-1"),api.emote_sets["BTTV-Global-1"].hidden=!BTTV.vars.show_emotes_in_menu,l={emoticons:c,title:"Global Emoticons (GIF)"},api.register_global_set("BTTV-Global-2",l),BTTV.vars.global_emotes&&BTTV.vars.gif_emotes||api.unregister_global_set("BTTV-Global-2"),api.emote_sets["BTTV-Global-2"].hidden=!BTTV.vars.show_emotes_in_menu,l={emoticons:d,title:"Global Emoticons (Override)"},api.register_global_set("BTTV-Global-3",l),BTTV.vars.global_emotes&&BTTV.vars.override_emotes||api.unregister_global_set("BTTV-Global-3"),api.emote_sets["BTTV-Global-3"].hidden=!BTTV.vars.show_emotes_in_menu,BTTV.vars.global_emotes_loaded=!0}).fail(function(b){if(404!==b.status)return a=(a||0)+1,a<12?(BTTV.log("Failed to fetch global emotes. Trying again in 5 seconds."),setTimeout(BTTV.addGlobals.bind(this,a),5e3)):void 0})},addChannel:function(a,b,c){BTTV.vars.pro_emotes&&BTTV.vars.socket.joinChannel(a),$.getJSON("https://api.betterttv.net/2/channels/"+a).done(function(b){for(var c=[],d=[],e=b.emotes,f=e.length;f--;){var g=/[^A-Za-z0-9]/.test(e[f].code),h=e[f],i=h.id,j={urls:{1:"https://cdn.betterttv.net/emote/"+i+"/1x",2:"https://cdn.betterttv.net/emote/"+i+"/2x",4:"https://cdn.betterttv.net/emote/"+i+"/3x"},id:i,name:h.code,width:28,height:28,owner:{display_name:h.channel||a,name:h.channel},require_spaces:g};"gif"===h.imageType?d.push(j):c.push(j)}if(c.length||d.length){BTTV.vars.channels[a]={emotes:"BTTV-Channel-"+BTTV.vars.last_emote_set_id,gifemotes_setid:"BTTV-Channel-"+(BTTV.vars.last_emote_set_id+1)},BTTV.vars.last_emote_set_id+=2;var k={emoticons:c,title:"Emoticons"};c.length&&(api.register_room_set(a,BTTV.vars.channels[a].emotes,k),api.emote_sets[BTTV.vars.channels[a].emotes].hidden=!BTTV.vars.show_emotes_in_menu),k={emoticons:d,title:"Emoticons (GIF)"},BTTV.vars.channels[a].gifemotes=jQuery.extend(!0,{},k);var l=jQuery.extend(!0,{},k),m=l.emoticons,n=function(b,c){var d=document.createElement("canvas"),e=d.getContext("2d");d.width=this.width,d.height=this.height,e.drawImage(this,0,0),BTTV.vars.channels[a].gifemotes_still||(BTTV.vars.channels[a].gifemotes_still=l),m[b].urls[c]=d.toDataURL(),api.register_room_set(a,BTTV.vars.channels[a].gifemotes_setid,BTTV.vars.channels[a].gifemotes_still),api.emote_sets[BTTV.vars.channels[a].gifemotes_setid].hidden=!BTTV.vars.show_emotes_in_menu},o=function(a,b,c,d,e){console.log("Couldn't load.")};for(f=m.length;f--;)for(var p=m[f],q=p.urls.length;q--;){var r=p.urls[f],s=new Image;s.onload=n.bind(s,f,r),s.onerror=o,s.crossOrigin="anonymous",s.src=p.urls[r]+".png"}api.register_room_set(a,BTTV.vars.channels[a].gifemotes_setid,k),api.emote_sets[BTTV.vars.channels[a].gifemotes_setid].hidden=!BTTV.vars.show_emotes_in_menu,BTTV.vars.gif_emotes||api.unload_set(BTTV.vars.channels[a].gifemotes_setid)}}).fail(function(d){if(404!==d.status)return c=(c||0)+1,c<12?(BTTV.log("Failed to fetch channel emotes. Trying again in 5 seconds."),setTimeout(BTTV.addChannel.bind(this,a,b,c),5e3)):void 0})},ProUser:function(a,b){this.username=a,this.emotes_array=b,this.initialize(),BTTV.ProUsers[this.username]=this},ProUsers:{},Socket:function(){this.socket=!1,this._lookedUpUsers=[],this._connected=!1,this._connecting=!1,this._connectAttempts=1,this._joinedChannels=[],this._connectionBuffer=[],this._events=BTTV.SocketEvents},SocketEvents:{lookup_user:function(a){a.pro&&BTTV.vars.pro_emotes&&a.pro&&a.emotes&&(a.name in BTTV.ProUsers?(BTTV.ProUsers[a.name].emotes_array=a.emotes,BTTV.ProUsers[a.name].loadEmotes()):new BTTV.ProUser(a.name,a.emotes))}}};BTTV.ProUser.prototype.loadEmotes=function(){this.emotes=[],this.emotes_array.forEach(function(a,b,c){var d={urls:{1:"https://cdn.betterttv.net/emote/"+a.id+"/1x",2:"https://cdn.betterttv.net/emote/"+a.id+"/2x",4:"https://cdn.betterttv.net/emote/"+a.id+"/3x"},id:a.id,name:a.code,width:28,height:28,owner:{display_name:a.channel||"",name:a.channel||""},require_spaces:!0};"png"===a.imageType&&this.emotes.push(d)},this);var a={emoticons:this.emotes,title:"Personal Emotes"};this.emotes.length&&(api.load_set(this._id_emotes,a),api.user_add_set(this.username,this._id_emotes))},BTTV.ProUser.prototype.initialize=function(){this._id_emotes="BTTV-ProUser-"+this.username,this.loadEmotes()},BTTV.Socket.prototype.connect=function(){if(void 0!==ffz.get_user()&&!this._connected&&!this._connecting){this._connecting=!0,BTTV.log("Socket: Connecting to socket server...");var a=this;this.socket=new WebSocket("wss://sockets.betterttv.net/ws"),this.socket.onopen=function(){if(BTTV.log("Socket: Connected to socket server."),a._connected=!0,a._connectAttempts=1,a._connectionBuffer.length>0){for(var b=a._connectionBuffer.length;b--;){var c=a._connectionBuffer[b];a.joinChannel(c),a.broadcastMe(c)}a._connectionBuffer=[]}},this.socket.onerror=function(){BTTV.log("Socket: Error from socket server."),a._connectAttempts++,a.reconnect()},this.socket.onclose=function(){a._connected&&a.socket&&(BTTV.log("Socket: Disconnected from socket server."),a._connectAttempts++,a.reconnect())},this.socket.onmessage=function(b){var c;try{c=JSON.parse(b.data)}catch(a){BTTV.log("Socket: Error parsing message",a)}c&&c.name in a._events&&(BTTV.log("Socket: Received event",c),a._events[c.name](c.data))}}},BTTV.Socket.prototype.reconnect=function(){var a=this;this.disconnect(),this._connecting!==!1&&(this._connecting=!1,setTimeout(function(){a.connect()},Math.random()*(Math.pow(2,this._connectAttempts)-1)*3e4))},BTTV.Socket.prototype.disconnect=function(){if(this.socket)try{this.socket.close()}catch(a){}delete this.socket,this._connected=!1},BTTV.Socket.prototype.emit=function(a,b){this._connected&&this.socket&&this.socket.send(JSON.stringify({name:a,data:b}))},BTTV.Socket.prototype.broadcastMe=function(a){this._connected&&ffz.get_user()&&this.emit("broadcast_me",{name:ffz.get_user().login,channel:a})},BTTV.Socket.prototype.joinChannel=function(a){return this._connected?void(a.length&&(this._joinedChannels[a]&&this.emit("part_channel",{name:a}),this.emit("join_channel",{name:a}),this._joinedChannels[a]=!0)):void(this._connectionBuffer.includes(a)||this._connectionBuffer.push(a))},registerAddon(BTTV);var GameWisp={name:"GameWisp",log:function(a){api.log("["+GameWisp.name+"] "+a)},init:function(){console.log("[GameWisp] Addon initialized!")},doSettings:function(){},room_message:function(a){},room_add:function(a,b,c){},chat_view_init:function(a,b){},chat_view_destroy:function(a,b){}};registerAddon(GameWisp);var MaiWaifu={name:"MaiWaifu",log:function(a){api.log("["+MaiWaifu.name+"] "+a)},vars:{enabled:!0,trihex_only:!1,use_click:!1,socket:!1,currentWaifu:!1,pane:!1,boundingBox:!1,currentSlide:0,mouseMovement:0},doSettings:function(){FrankerFaceZ.settings_info.maiwaifu_enabled={type:"boolean",value:MaiWaifu.vars.enabled,category:"TOE",name:"[MaiWaifu] Enabled",help:"Enable this to activate MaiWaifu.",on_update:function(a){MaiWaifu.vars.enabled=a}},FrankerFaceZ.settings_info.maiwaifu_trihex_only={type:"boolean",value:MaiWaifu.vars.trihex_only,category:"TOE",name:"[MaiWaifu] Trihex only",help:"Enable this to only make the MaiWaifu badges available on Trihex' stream.",on_update:function(a){MaiWaifu.vars.trihex_only=a}},FrankerFaceZ.settings_info.maiwaifu_use_click={type:"boolean",value:MaiWaifu.vars.use_click,category:"TOE",name:"[MaiWaifu] Click instead of Hover",help:"Enable this for having to click on the badge instead of hovering over it.",on_update:function(a){MaiWaifu.vars.use_click=a}},MaiWaifu.vars.enabled=ffz.settings.get("maiwaifu_enabled"),MaiWaifu.vars.trihex_only=ffz.settings.get("maiwaifu_trihex_only"),MaiWaifu.vars.use_click=ffz.settings.get("maiwaifu_use_click")},init:function(){console.log("[MaiWaifu] Addon initialized!"),MaiWaifu.vars.socket=new MaiWaifu.Socket,MaiWaifu.vars.enabled&&MaiWaifu.vars.socket.connect(MaiWaifu.createWaifuPane()),api.add_badge("maiwaifu",{name:"maiwaifu",title:"MaiWaifu",image:"https://mywaif.us/waifu-badge.png",no_invert:!0,no_tooltip:!0,click_action:MaiWaifu.on_badge_click})},room_add:function(a,b,c){},room_message:function(a){},chat_view_init:function(a,b){jQuery(a).on("mouseenter",".ffz-badge-2-maiwaifu",MaiWaifu.on_badge_hover),jQuery(document).on("mousemove",MaiWaifu.mouseMovement)},chat_view_destroy:function(a,b){},createWaifuPane:function(){MaiWaifu.vars.pane=document.createElement("div"),MaiWaifu.vars.pane.className="waifuPane",MaiWaifu.vars.pane.style.display="none",MaiWaifu.vars.pane.style.backgroundColor="rgba(0, 0, 0, 0.9)",MaiWaifu.vars.pane.style.position="absolute",MaiWaifu.vars.pane.style.zIndex="9999",MaiWaifu.vars.pane.style.color="#FFF",MaiWaifu.vars.pane.style.width="240px",MaiWaifu.vars.pane.style.padding="20px",MaiWaifu.vars.boundingBox=document.createElement("div"),MaiWaifu.vars.boundingBox.style.marginLeft="40px",MaiWaifu.vars.boundingBox.style.position="absolute",MaiWaifu.vars.boundingBox.style.paddingLeft="10px",MaiWaifu.vars.boundingBox.style.top="0px",document.body.appendChild(MaiWaifu.vars.boundingBox),MaiWaifu.vars.boundingBox.appendChild(MaiWaifu.vars.pane)},mouseMovement:function(a){MaiWaifu.vars.currentWaifu&&(a.target.className.indexOf("waifu")!=-1?MaiWaifu.vars.mouseMovement=0:(MaiWaifu.vars.mouseMovement+=1,MaiWaifu.vars.mouseMovement>=50&&MaiWaifu.fadeOutWaifu()))},openWaifuPane:function(a){MaiWaifu.requestWaifu(a,function(){MaiWaifu.vars.pane.topCoord=100}),MaiWaifu.vars.mouseMovement=0},updateWaifuPane:function(a){MaiWaifu.fadeInWaifu(),MaiWaifu.vars.currentSlide=1,clearInterval(MaiWaifu.vars.pane.slideshow),MaiWaifu.vars.pane.innerHTML="",MaiWaifu.vars.boundingBox.style.left="500px",MaiWaifu.vars.boundingBox.style.width="300px";var b=document.createElement("div");b.className="waifuHeader",b.textContent=MaiWaifu.vars.currentWaifu.user.capitalize()+"'s "+MaiWaifu.vars.currentWaifu.gender.capitalize()+": ",b.style.marginBottom="5px";var c=document.createElement("div");c.className="waifuName",c.textContent=MaiWaifu.vars.currentWaifu.waifu,c.style.marginBottom="10px",c.style.fontWeight="bolder";for(var d=0;d<MaiWaifu.vars.currentWaifu.images.length;d++){var e=new Image;e.src=MaiWaifu.vars.currentWaifu.images[d]}var f=document.createElement("div");f.className="waifuPic",f.style.width="200px",f.style.height="200px",f.style.backgroundSize="contain",f.style.marginBottom="10px",f.style.transition="ease 2s",f.style.transitionDelay="200ms";var g=MaiWaifu.vars.currentWaifu.images[0].match(/imgur\.com\/([A-Za-z0-9\.]+)/)[1];f.style.backgroundImage="url(https://miku.mywaif.us/imgur/?"+g+")",f.style.backgroundRepeat="no-repeat",f.style.backgroundPosition="center center",MaiWaifu.vars.pane.slideshow=setInterval(function(){return MaiWaifu.vars.currentWaifu?void(MaiWaifu.vars.currentSlide<MaiWaifu.vars.currentWaifu.images.length?(g=MaiWaifu.vars.currentWaifu.images[MaiWaifu.vars.currentSlide].match(/imgur\.com\/([A-Za-z0-9\.]+)/)[1],f.style.backgroundImage="url(https://miku.mywaif.us/imgur/?"+g+")",MaiWaifu.vars.currentSlide++):MaiWaifu.vars.currentSlide=0):void clearInterval(MaiWaifu.vars.pane.slideshow)},5e3);var h=document.createElement("div");h.className="waifuStats";var i=document.createElement("br");i.className="waifuSpace";var j=document.createElement("div");j.className="waifuSeries",j.innerHTML="Series:",j.style.fontWeight="bold",j.style.float="left",j.style.paddingRight="5px";var k=document.createElement("div");k.className="waifuSeries",k.textContent=MaiWaifu.vars.currentWaifu.series;var l=document.createElement("div");l.className="waifuType",l.innerHTML="Type:",l.style.fontWeight="bold",l.style.float="left",l.style.paddingRight="5px";var m=document.createElement("div");m.textContent=MaiWaifu.vars.currentWaifu.type,m.className="waifuType";var n=document.createElement("div");if(n.className="waifuSummary",n.textContent=MaiWaifu.vars.currentWaifu.summary,n.style.position="relative",h.appendChild(i),h.appendChild(j),h.appendChild(k),h.appendChild(l),h.appendChild(m),h.appendChild(i),h.appendChild(n),MaiWaifu.vars.currentWaifu.subbedSince){var o=document.createElement("br");o.className="waifuSpace",h.appendChild(o);var p=document.createElement("div");p.className="waifuSubbedSince",p.innerHTML="Subbed for "+MaiWaifu.vars.currentWaifu.subbedSince+" months.",h.appendChild(p)}if(MaiWaifu.vars.pane.appendChild(b),MaiWaifu.vars.pane.appendChild(c),MaiWaifu.vars.pane.appendChild(f),MaiWaifu.vars.pane.appendChild(h),!ffz.get_user()||ffz.get_user()&&ffz.get_user().login!==MaiWaifu.vars.currentWaifu.user){var q=document.createElement("div");q.className="waifu ReportContainer",q.style.cssFloat="right";var r=document.createElement("a");r.className="waifu ReportButton",r.title="Report Meme or Nudity";var s=document.createTextNode("Report");r.appendChild(s),r.onclick=function(){MaiWaifu.reportUser(MaiWaifu.vars.currentWaifu.user,r,s)},q.appendChild(r),MaiWaifu.vars.pane.appendChild(q)}a()},getRequest:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.open("GET",a,!0),c.send(null)},requestWaifu:function(a,b){MaiWaifu.vars.socket.requestWaifu(a,b)},reportUser:function(a,b,c){MaiWaifu.getRequest("https://miku.mywaif.us:8055/report/"+a,function(){}),c.nodeValue="Reported",b.style.textDecoration="none"},fadeOutWaifu:function(){var a=1,b=setInterval(function(){a<=.1&&(clearInterval(b),MaiWaifu.vars.pane.style.display="none",MaiWaifu.vars.currentWaifu=!1),MaiWaifu.vars.pane.style.opacity=a,MaiWaifu.vars.pane.style.filter="alpha(opacity="+100*a+")",a-=.1*a},10)},fadeInWaifu:function(){var a=.1;MaiWaifu.vars.pane.style.display="block";var b=setInterval(function(){a>=1&&clearInterval(b),MaiWaifu.vars.pane.style.opacity=a,MaiWaifu.vars.pane.style.filter="alpha(opacity="+100*a+")",a+=.1*a},10)},on_badge_hover:function(){if(!MaiWaifu.vars.use_click){var a=jQuery(this).parents(".chat-line")[0].getAttribute("data-sender");MaiWaifu.openWaifuPane(a)}},on_badge_click:function(a,b){MaiWaifu.vars.use_click&&MaiWaifu.openWaifuPane(a.from)},Waifu:function(a,b,c,d,e,f,g,h,i){this.user=a,this.waifu=b,this.series=c,this.images=d,this.lewd=e,this.gender=f,this.type=g,this.summary=h,this.subbedSince=i},Waifus:[],Socket:function(){MaiWaifu.waifuPane=!1,MaiWaifu.socket=!1,MaiWaifu.Waifus=[]}};MaiWaifu.Socket.prototype.connect=function(a){MaiWaifu.vars.enabled&&(this.socket=new WebSocket("wss://miku.mywaif.us:8081"),this.socket.waifuList=MaiWaifu.Waifus.waifuList,this.socket.onopen=function(a){},this.socket.onmessage=function(a){var b=JSON.parse(a.data);if(b.waifu)w=b,MaiWaifu.vars.currentWaifu=new MaiWaifu.Waifu(w.user,w.waifu,w.series,w.images,w.lewd,w.gender,w.type,w.summary,w.subbedSince),MaiWaifu.updateWaifuPane(function(){var a=MaiWaifu.vars.pane.topCoord-MaiWaifu.vars.pane.offsetHeight;a<0?MaiWaifu.vars.pane.style.top="0px":MaiWaifu.vars.pane.style.top=MaiWaifu.vars.pane.topCoord-MaiWaifu.vars.pane.offsetHeight+"px"});else if(1==b.length)MaiWaifu.Waifus.indexOf(b[0])>-1&&(MaiWaifu.Waifus.push(b),api.user_add_badge(b[0],21,"maiwaifu"),MaiWaifu.log("Socket: Added "+b[0]+" to waifu list."));else{MaiWaifu.Waifus.push(b);for(var c=0;c<b.length;c++)api.user_add_badge(b[c],21,"maiwaifu");MaiWaifu.log("Socket: Connected! Added "+b.length+" users to waifu list.")}},this.socket.onclose=function(a){MaiWaifu.log("Socket: Connection closed."),setTimeout(function(){MaiWaifu.log("Socket: Retrying...."),MaiWaifu.vars.socket=new MaiWaifu.Socket,MaiWaifu.vars.socket.connect()},1e4)})},MaiWaifu.Socket.prototype.requestWaifu=function(a,b){this.socket.send(a),b()},registerAddon(MaiWaifu);